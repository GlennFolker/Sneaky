plugins {
    id 'java'
}

sourceSets.main.java.srcDirs = ['src/']

ext {
    mainClassName = 'sneaky.Sneaky'
}

dependencies {
    annotationProcessor 'com.github.bsideup.jabel:jabel-javac-plugin:0.4.1'

    compileOnly project(':plugin')
    annotationProcessor project(':plugin')
}

repositories {
    mavenCentral()
}

tasks.withType(JavaCompile) {
    sourceCompatibility = 16
    targetCompatibility = 8

    if(JavaVersion.current() != JavaVersion.VERSION_1_8){
        options.compilerArgs = [
            '--release', '8',
            '--enable-preview'
        ]
    }

    doFirst {
        options.compilerArgs = options.compilerArgs.findAll {
            it != '--enable-preview'
        }
    }
}

jar {
    manifest {
        attributes 'Main-Class': mainClassName
    }
}

task run(type: JavaExec, dependsOn: [classes, configurations.runtimeClasspath]) {
    main = mainClassName
    classpath = sourceSets.main.runtimeClasspath
    standardInput = System.in
}
